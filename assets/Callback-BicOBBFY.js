import{a as S}from"./index-CmmzNXUp.js";import{B as v}from"./Button-6hWhDUK7.js";import{q as T,a2 as h,a8 as x,Q as C,_ as M,R as l,o as n,m as s,l as i,T as d,k as o,S as f,h as p,g as z}from"./app-CLJvurN3.js";import{N as B}from"./Input-DhYCGtaB.js";import{N as P}from"./Alert-DzKHEb0O.js";const U=T({__name:"Callback",setup(y,{expose:r}){r();const c=new URL(window.location.href),e=c.searchParams.get("code"),g=c.searchParams.get("state"),_=c.searchParams.get("error"),k=c.searchParams.get("error_description"),a=h({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1}),m=()=>{fetch(`${S()}/alist/onedrive/get_refresh_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,client:g})}).then(t=>t.json()).then(t=>{if(console.log(t),t.error){a.error1=t.error,a.errorMessage1=t.error_description;return}a.refreshToken=t.refresh_token,a.accessToken=t.access_token})};e&&g&&!_&&m();const[I,b,N]=atob(g).split("::"),u={url:c,code:e,client:g,error:_,error_description:k,data:a,getToken:m,client_id:I,client_secret:b,zone:N,getSiteId:()=>{a.gettingSiteId=!0,fetch(`${S()}/alist/onedrive/get_site_id`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:a.siteUrl,access_token:a.accessToken,zone:N})}).then(t=>(a.gettingSiteId=!1,t.json())).then(t=>{if(t.error){a.error2=t.error,a.errorMessage2=t.error.message;return}a.siteId=t.id})},get NAlert(){return P},get NButton(){return v},get NInput(){return B},get NSpace(){return C},get NSpin(){return x}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),j={key:2};function A(y,r,c,e,g,_){return!e.code||!e.client||e.error?(n(),l(e.NAlert,{key:0,title:e.error||"Error",type:"error"},{default:s(()=>[i(d(e.error_description),1)]),_:1},8,["title"])):(n(),l(e.NSpace,{key:1,vertical:"",size:"large"},{default:s(()=>[o("p",null,[r[1]||(r[1]=o("b",null,"client_id: ",-1)),i(d(e.client_id),1)]),o("p",null,[r[2]||(r[2]=o("b",null,"client_secret: ",-1)),i(d(e.client_secret),1)]),o("p",null,[r[3]||(r[3]=o("b",null,"zone: ",-1)),i(d(e.zone),1)]),r[8]||(r[8]=o("p",null,[o("b",null,"redirect_uri: "),i("https://alist.example.com/tool/onedrive/callback")],-1)),e.data.error1||e.data.errorMessage1?(n(),l(e.NAlert,{key:0,title:e.data.error1,type:"error"},{default:s(()=>[i(d(e.data.errorMessage1),1)]),_:1},8,["title"])):f("",!0),p(e.NSpace,{vertical:""},{default:s(()=>[r[4]||(r[4]=o("b",null,"refresh_token:",-1)),!e.data.refreshToken&&!e.data.errorMessage1?(n(),l(e.NSpin,{key:0})):(n(),l(e.NInput,{key:1,type:"textarea",autosize:"",readonly:"",value:e.data.refreshToken},null,8,["value"]))]),_:1}),e.data.accessToken?(n(),l(e.NSpace,{key:1,vertical:"",size:"large"},{default:s(()=>[r[7]||(r[7]=o("h3",null,"Get sharepoint site ID",-1)),e.data.error2||e.data.errorMessage2?(n(),l(e.NAlert,{key:0,title:e.data.error2,type:"error"},{default:s(()=>[i(d(e.data.errorMessage2),1)]),_:1},8,["title"])):f("",!0),p(e.NInput,{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.data.siteUrl,"onUpdate:value":r[0]||(r[0]=k=>e.data.siteUrl=k)},null,8,["value"]),p(e.NButton,{type:"primary",size:"large",onClick:e.getSiteId},{default:s(()=>r[5]||(r[5]=[i("Get SiteID")])),_:1}),e.data.gettingSiteId?(n(),l(e.NSpin,{key:1})):e.data.siteId?(n(),z("p",j,[r[6]||(r[6]=o("b",null,"site_id: ",-1)),i(d(e.data.siteId),1)])):f("",!0)]),_:1})):f("",!0)]),_:1}))}const J=M(U,[["render",A],["__scopeId","data-v-bd0a1b88"],["__file","Callback.vue"]]);export{J as C};
