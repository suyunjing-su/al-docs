import{a as F}from"./index-CmmzNXUp.js";import{a9 as A,aa as E,ab as x,q as P,r as l,Q as I,_ as z,R as v,o as g,m as r,h as o,g as U,S as _,l as i,O,T as b}from"./app-CbOD6f9r.js";import{N as j}from"./Checkbox-IF9AOjGW.js";import{B as R}from"./Button-BCI6j4vu.js";import{N as M}from"./Input-BefGBTxS.js";import{N as Q}from"./Image-CPgNsEdg.js";import{N as D}from"./Alert-ZmTor68y.js";function L(){const f=E(x,null);return f===null&&A("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),f}const w="https://alist.example.com/tool/aliyundrive/callback",B="76917ccccd4441c39457a04f6084fb2f",T=P({__name:"Request",setup(f,{expose:t}){t();function S(){const a=new URL("https://open.aliyundrive.com/oauth/authorize");a.searchParams.set("client_id",n.value?c.value:B),a.searchParams.set("redirect_uri",w),a.searchParams.set("scope","user:base,file:all:read,file:all:write"),a.searchParams.set("response_type","code"),a.searchParams.set("state",window.btoa(n.value?`${c.value}::${u.value}`:"::")),a.searchParams.set("relogin","true"),window.open(a.toString(),"_blank")}const e=l(),m=l(!1),c=l(""),u=l(""),n=l(!1);async function s(){try{m.value=!0;const d=await(await fetch(F()+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value?{client_id:c.value,client_secret:u.value}:{})})).json();e.value=d}catch(a){console.log(a),e.value={error:"error",qrCodeUrl:"",sid:""}}finally{m.value=!1}}const h=l(),y=l(!1),N=L();async function q(){var a;try{y.value=!0;const p=await(await fetch(`${F()}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(a=e.value)==null?void 0:a.sid}/status`)).json();if(h.value=p,p.status==="LoginSuccess"){const k=new URL(w);k.searchParams.set("code",p.authCode),window.open(k.toString(),"_blank")}else N.warning(p.status)}catch(d){console.log(d),N.error(String(d))}finally{y.value=!1}}const C={alist_redirect_uri:w,app_id:B,goGet:S,qrcode:e,gettingQrCode:m,client_id:c,client_secret:u,useMyOwn:n,getQrCode:s,scanStatus:h,gettingScanStatus:y,message:N,haveScan:q,get NButton(){return R},get NSpace(){return I},get NAlert(){return D},get NImage(){return Q},get NCheckbox(){return j},get NInput(){return M}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}});function V(f,t,S,e,m,c){return g(),v(e.NSpace,{vertical:"",size:"large"},{default:r(()=>{var u,n;return[o(e.NCheckbox,{checked:e.useMyOwn,"onUpdate:checked":t[0]||(t[0]=s=>e.useMyOwn=s),size:"large"},{default:r(()=>t[3]||(t[3]=[i("使用自己的客户端信息")])),_:1},8,["checked"]),e.useMyOwn?(g(),U(O,{key:0},[o(e.NInput,{size:"large",value:e.client_id,"onUpdate:value":t[1]||(t[1]=s=>e.client_id=s),placeholder:"client_id"},null,8,["value"]),o(e.NInput,{size:"large",value:e.client_secret,"onUpdate:value":t[2]||(t[2]=s=>e.client_secret=s),placeholder:"client_secret"},null,8,["value"])],64)):_("",!0),o(e.NButton,{size:"large",type:"primary",onClick:e.goGet,block:""},{default:r(()=>t[4]||(t[4]=[i("前往登录")])),_:1}),o(e.NButton,{size:"large",type:"info",onClick:e.getQrCode,block:"",loading:e.gettingQrCode,disabled:!!e.qrcode},{default:r(()=>t[5]||(t[5]=[i("扫描二维码 ")])),_:1},8,["loading","disabled"]),(u=e.qrcode)!=null&&u.error?(g(),v(e.NAlert,{key:1,title:"Error",type:"error"},{default:r(()=>[i(b(e.qrcode.error),1)]),_:1})):_("",!0),(n=e.qrcode)!=null&&n.qrCodeUrl?(g(),v(e.NSpace,{key:2,vertical:""},{default:r(()=>[o(e.NSpace,{justify:"center"},{default:r(()=>[o(e.NImage,{width:"300",src:e.qrcode.qrCodeUrl},null,8,["src"])]),_:1}),o(e.NAlert,{title:"扫描二维码",type:"info"},{default:r(()=>t[6]||(t[6]=[i("使用 AliyunDrive APP 扫描，然后点击下方按钮")])),_:1}),o(e.NButton,{size:"large",onClick:e.haveScan,type:"info",block:"",loading:e.gettingScanStatus},{default:r(()=>t[7]||(t[7]=[i("已扫码")])),_:1},8,["loading"])]),_:1})):_("",!0),e.scanStatus&&e.scanStatus.status!=="LoginSuccess"?(g(),v(e.NAlert,{key:3,title:"Warning",type:"warning"},{default:r(()=>[i(b(e.scanStatus.status),1)]),_:1})):_("",!0)]}),_:1})}const Z=z(T,[["render",V],["__scopeId","data-v-545b82dc"],["__file","Request.vue"]]);export{Z as R};
