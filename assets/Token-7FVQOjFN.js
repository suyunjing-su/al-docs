import{a as v}from"./index-CmmzNXUp.js";import{N as T}from"./Input-DhYCGtaB.js";import{N as x}from"./Alert-DzKHEb0O.js";import{N as A}from"./Image-rSxYp_OV.js";import{B as b}from"./Button-6hWhDUK7.js";import{q,r as t,Q as w,_ as P,R as u,o as l,m as o,h as n,S as s,l as d,T as B,k as C}from"./app-CLJvurN3.js";const R=q({__name:"Token",setup(F,{expose:r}){r();const _=t(""),e=t(""),i=t({uid:"",time:0,qrcode:"",sign:""}),c=t(""),f=t(""),g=t(!1);async function E(){g.value=!0,c.value="";const a=await(await fetch(v(`/alist/115/auth_device_code?app_id=${_.value}`))).json();if(g.value=!1,a.error){c.value=a.error;return}e.value=a.code_verifier,i.value=a.resp;const y=new URL(v("/qr"));y.searchParams.set("text",i.value.qrcode),f.value=y.toString()}const k=t(!1),p=t(""),N=t({access_token:"",refresh_token:"",expires_in:0});async function S(){k.value=!0,p.value="";const a=await(await fetch(v("/alist/115/get_token"),{method:"POST",body:JSON.stringify({code_verifier:e.value,uid:i.value.uid})})).json();if(k.value=!1,a.error){p.value=a.error;return}N.value=a.resp}const m={appId:_,codeVerifier:e,codeResp:i,error1:c,qrCode:f,gettingQrCode:g,generateQrcode:E,gettingToken:k,error2:p,tokenResp:N,getToken:S,get NButton(){return b},get NSpace(){return w},get NImage(){return A},get NAlert(){return x},get NInput(){return T}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}});function D(F,r,_,e,i,c){return l(),u(e.NSpace,{vertical:"",size:"large"},{default:o(()=>[n(e.NInput,{value:e.appId,"onUpdate:value":r[0]||(r[0]=f=>e.appId=f),placeholder:"APP ID, 不填则使用 Alist 默认提供"},null,8,["value"]),e.codeVerifier?s("",!0):(l(),u(e.NButton,{key:0,block:"",type:"primary",onClick:e.generateQrcode,loading:e.gettingQrCode},{default:o(()=>r[1]||(r[1]=[d("生成二维码")])),_:1},8,["loading"])),e.error1?(l(),u(e.NAlert,{key:1,title:"Error",type:"error"},{default:o(()=>[d(B(e.error1),1)]),_:1})):s("",!0),e.qrCode?(l(),u(e.NSpace,{key:2,vertical:""},{default:o(()=>[n(e.NSpace,{justify:"center"},{default:o(()=>[n(e.NImage,{width:"300",src:e.qrCode},null,8,["src"])]),_:1}),n(e.NAlert,{title:"扫描二维码",type:"info"},{default:o(()=>r[2]||(r[2]=[d("使用 115 APP 扫描二维码，然后点击下方按钮")])),_:1}),n(e.NButton,{size:"large",onClick:e.getToken,type:"info",block:"",loading:e.gettingToken},{default:o(()=>r[3]||(r[3]=[d("已扫码")])),_:1},8,["loading"]),e.error2?(l(),u(e.NAlert,{key:0,title:"Error",type:"error"},{default:o(()=>[d(B(e.error2),1)]),_:1})):s("",!0)]),_:1})):s("",!0),e.tokenResp.refresh_token?(l(),u(e.NSpace,{key:3,vertical:""},{default:o(()=>[r[4]||(r[4]=C("b",null,"refresh_token:",-1)),n(e.NInput,{type:"textarea",autosize:"",readonly:"",value:e.tokenResp.refresh_token},null,8,["value"]),r[5]||(r[5]=C("b",null,"access_token:",-1)),n(e.NInput,{type:"textarea",autosize:"",readonly:"",value:e.tokenResp.access_token},null,8,["value"])]),_:1})):s("",!0)]),_:1})}const U=P(R,[["render",D],["__file","Token.vue"]]);export{U as T};
